<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>cugbliwei</title>
  
  <subtitle>渐行渐远渐无声，花谢花飞花满天</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://cugbliwei.tech/"/>
  <updated>2019-07-07T07:09:43.000Z</updated>
  <id>http://cugbliwei.tech/</id>
  
  <author>
    <name>liwei</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>vim本人配置及实用命令</title>
    <link href="http://cugbliwei.tech/posts/4887/"/>
    <id>http://cugbliwei.tech/posts/4887/</id>
    <published>2019-07-07T06:57:58.000Z</published>
    <updated>2019-07-07T07:09:43.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="实用命令"><a href="#实用命令" class="headerlink" title="实用命令"></a>实用命令</h2><p>垂直分屏：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">:vsp [文件名]</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">&gt; 注：不写文件名则默认打开正在编辑的文件，文件名可用正则写，如 :vsp sour****.<span class="keyword">py</span></span><br><span class="line"></span><br><span class="line">水平分屏：</span><br><span class="line"></span><br><span class="line">``` <span class="keyword">vim</span></span><br><span class="line">:<span class="keyword">sp</span> [文件名]</span><br></pre></td></tr></table></figure><p>切换窗口：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctrl + <span class="keyword">w</span> + h/<span class="keyword">j</span>/<span class="keyword">k</span>/<span class="keyword">l</span>（最后字母为方向键）</span><br></pre></td></tr></table></figure><a id="more"></a><p>函数中转：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">,gd</span><br></pre></td></tr></table></figure><p>函数中转返回最初的函数：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">b</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;实用命令&quot;&gt;&lt;a href=&quot;#实用命令&quot; class=&quot;headerlink&quot; title=&quot;实用命令&quot;&gt;&lt;/a&gt;实用命令&lt;/h2&gt;&lt;p&gt;垂直分屏：&lt;/p&gt;
&lt;figure class=&quot;highlight vim&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;:vsp [文件名]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;``` &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;gt; 注：不写文件名则默认打开正在编辑的文件，文件名可用正则写，如 :vsp sour****.&lt;span class=&quot;keyword&quot;&gt;py&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;水平分屏：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;``` &lt;span class=&quot;keyword&quot;&gt;vim&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;:&lt;span class=&quot;keyword&quot;&gt;sp&lt;/span&gt; [文件名]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;切换窗口：&lt;/p&gt;
&lt;figure class=&quot;highlight vim&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ctrl + &lt;span class=&quot;keyword&quot;&gt;w&lt;/span&gt; + h/&lt;span class=&quot;keyword&quot;&gt;j&lt;/span&gt;/&lt;span class=&quot;keyword&quot;&gt;k&lt;/span&gt;/&lt;span class=&quot;keyword&quot;&gt;l&lt;/span&gt;（最后字母为方向键）&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="技术" scheme="http://cugbliwei.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="vim" scheme="http://cugbliwei.tech/categories/%E6%8A%80%E6%9C%AF/vim/"/>
    
    
      <category term="vim" scheme="http://cugbliwei.tech/tags/vim/"/>
    
  </entry>
  
  <entry>
    <title>mysql查询中的varchar列用int查询对索引的影响</title>
    <link href="http://cugbliwei.tech/posts/4728/"/>
    <id>http://cugbliwei.tech/posts/4728/</id>
    <published>2019-07-03T01:27:59.000Z</published>
    <updated>2019-07-03T02:21:07.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>之前线上的一个服务，我来之后是由我来接手的，然后那时有人跟我反馈说有的sql查询慢，我查了之后发现是索引的建立和查询不对头，问后端想要哪些索引或者哪些比较快的查询，知道所有的需求之后，然后我就重新建了表，重建索引，当时测试都没有问题了。</p><a id="more"></a><p>然而半年之后的昨天，又有人反馈发给我sql查询慢，我还奇怪，索引挺多的，由于数据也挺大，每天增量1000多万条数据，所以也导致表数据和索引都很大，不过只保留10天数据，所以有索引的情况下，查询还是很快的，在测试后端所有可能涉及的sql下，一般都是在1s以下，那为何还反馈说查询慢呢？</p><h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><p>然后我就看了他发给我的sql，类似下面：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from src_ios_rank_hour where dateid=20190702 and game_id in (1245560420, 1257031979, 895670960);</span><br></pre></td></tr></table></figure><p>然后查询了下，花了5s多，确实挺慢，有时候会更慢。</p><p>然后我的第一反映是 game_id 列是varchar，这样用数字查询会不会导致查询慢，然后我就加上引号：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from src_ios_rank_hour where dateid=20190702 and game_id in (&apos;1245560420&apos;, &apos;1257031979&apos;, &apos;895670960&apos;);</span><br></pre></td></tr></table></figure><p>重新查询了一下，发现非常快，只花了0.05秒</p><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p>然后就觉得应该是这个原因引起的，google了一下原因，发现是：</p><p>mysql这种情况不会触发索引，是全表查询，所以会导致索引失效，查询慢</p><p>所以以后sql语句，还是按照标准来写好了</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h3&gt;&lt;p&gt;之前线上的一个服务，我来之后是由我来接手的，然后那时有人跟我反馈说有的sql查询慢，我查了之后发现是索引的建立和查询不对头，问后端想要哪些索引或者哪些比较快的查询，知道所有的需求之后，然后我就重新建了表，重建索引，当时测试都没有问题了。&lt;/p&gt;
    
    </summary>
    
      <category term="技术" scheme="http://cugbliwei.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="mysql" scheme="http://cugbliwei.tech/categories/%E6%8A%80%E6%9C%AF/mysql/"/>
    
    
      <category term="mysql" scheme="http://cugbliwei.tech/tags/mysql/"/>
    
      <category term="索引" scheme="http://cugbliwei.tech/tags/%E7%B4%A2%E5%BC%95/"/>
    
  </entry>
  
  <entry>
    <title>记一次hadoop MR调用第三方库超内存的bug</title>
    <link href="http://cugbliwei.tech/posts/38528/"/>
    <id>http://cugbliwei.tech/posts/38528/</id>
    <published>2019-06-27T12:13:29.000Z</published>
    <updated>2019-06-27T12:52:06.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>使用hadoop steaming 跑python脚本的来解析爬虫数据的，之前一直跑得好好的，然后突然2019-06-19的数据猛然增加，那天主要是爬的b站的视频评论太多太大，但也只是每个文件2个多G，总共20个文件罢了。</p><p>开始以为是内存不够，增加了map和reduce的内存，然后又修改别的参数，弄了好久，依然内存超出，出错都是如下图所示：</p><a id="more"></a><p><img src="/posts/38528/memory.png" alt="memory"></p><h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><p>主要是对hadoop还不是很熟悉，所以在周会上提了一下，周会结束后同事帮我debug了一下，看了MR相关log，然后把出错的源数据提取出来单独执行，然后找到了出错的记录，我又单行debug了一下，发现是在调用一个第三方包的代码出了问题，尼玛，坑死人啊。</p><p>出bug的包是：</p><p><a href="https://github.com/skydark/nstools/blob/master/zhtools/langconv.py" target="_blank" rel="noopener">langconv</a></p><p>class Converter， def convert(self, string)</p><p>这个函数是用来把繁体转为简体的，出错的记录中的字符串是: </p><p>“我才收到消息推送一打开就有大佬发了这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么这么长的长评了啊”</p><p>我进入到这个函数中输出了一下，发现在死循环，是在”这么”这个词出现的，本来想修改这个bug的，后来想想可能还隐藏其他bug，改了后面可能还会越来越多，算了，还是再找一个靠谱点的包吧</p><h3 id="fix"><a href="#fix" class="headerlink" title="fix"></a>fix</h3><p>使用</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h3&gt;&lt;p&gt;使用hadoop steaming 跑python脚本的来解析爬虫数据的，之前一直跑得好好的，然后突然2019-06-19的数据猛然增加，那天主要是爬的b站的视频评论太多太大，但也只是每个文件2个多G，总共20个文件罢了。&lt;/p&gt;
&lt;p&gt;开始以为是内存不够，增加了map和reduce的内存，然后又修改别的参数，弄了好久，依然内存超出，出错都是如下图所示：&lt;/p&gt;
    
    </summary>
    
      <category term="技术" scheme="http://cugbliwei.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="hadoop" scheme="http://cugbliwei.tech/categories/%E6%8A%80%E6%9C%AF/hadoop/"/>
    
    
      <category term="hadoop" scheme="http://cugbliwei.tech/tags/hadoop/"/>
    
      <category term="python" scheme="http://cugbliwei.tech/tags/python/"/>
    
      <category term="langconv" scheme="http://cugbliwei.tech/tags/langconv/"/>
    
  </entry>
  
  <entry>
    <title>博客搭建与写博客要点</title>
    <link href="http://cugbliwei.tech/posts/54634/"/>
    <id>http://cugbliwei.tech/posts/54634/</id>
    <published>2018-12-18T02:36:00.000Z</published>
    <updated>2019-06-27T12:33:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Hexo-官方"><a href="#Hexo-官方" class="headerlink" title="Hexo 官方"></a>Hexo 官方</h2><p><a href="https://hexo.io/" target="_blank" rel="noopener">Hexo主页</a></p><p><a href="https://hexo.io/docs/" target="_blank" rel="noopener">Hexo官方文档</a> </p><p><a href="https://github.com/hexojs/hexo" target="_blank" rel="noopener">GitHub</a></p><a id="more"></a><h2 id="搭建教程"><a href="#搭建教程" class="headerlink" title="搭建教程"></a>搭建教程</h2><p>用hexo搭建github.io博客，参考：<a href="https://zhuanlan.zhihu.com/p/25729240" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/25729240</a></p><h2 id="博客主题"><a href="#博客主题" class="headerlink" title="博客主题"></a>博客主题</h2><p>使用主题：<a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="noopener">https://github.com/litten/hexo-theme-yilia</a></p><h2 id="Markdown编辑器"><a href="#Markdown编辑器" class="headerlink" title="Markdown编辑器"></a>Markdown编辑器</h2><p>新手可以使用Markdown编辑器：<a href="https://typora.io/" target="_blank" rel="noopener">typora</a></p><p>方便的地方在于写的地方即预览的地方</p><p>Markdown的一些：<a href="https://zhangslob.github.io/2017/02/26/%E5%88%A9%E7%94%A8HEXO%E6%90%AD%E5%BB%BA%E7%9A%84%E5%8D%9A%E5%AE%A2/" target="_blank" rel="noopener">常用语法</a></p><p>一般敲代码用vim，所以熟悉Markdown语法之后，编辑器就不需要了</p><h2 id="hexo-搭建"><a href="#hexo-搭建" class="headerlink" title="hexo 搭建"></a>hexo 搭建</h2><h3 id="node-amp-git"><a href="#node-amp-git" class="headerlink" title="node &amp; git"></a>node &amp; git</h3><p>先安装nodejs 和 git</p><h3 id="安装-hexo"><a href="#安装-hexo" class="headerlink" title="安装 hexo"></a>安装 hexo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g hexo-cli</span><br></pre></td></tr></table></figure><h3 id="博客目录"><a href="#博客目录" class="headerlink" title="博客目录"></a>博客目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init blog</span><br></pre></td></tr></table></figure><h2 id="hexo写博客步骤"><a href="#hexo写博客步骤" class="headerlink" title="hexo写博客步骤"></a>hexo写博客步骤</h2><h3 id="新建文章"><a href="#新建文章" class="headerlink" title="新建文章"></a>新建文章</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"标题名称"</span></span><br></pre></td></tr></table></figure><p>然后用 vim 或 typora 编辑器写好文章</p><h3 id="本地测试"><a href="#本地测试" class="headerlink" title="本地测试"></a>本地测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>然后打开<a href="http://localhost:4000/" target="_blank" rel="noopener">本地地址</a> 本地服务地址查看文章</p><h3 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><h3 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>发布即可在<a href="https://cugbliwei.github.io" target="_blank" rel="noopener">我的博客</a>查看远程文章</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>hexo deploy 可能会出错，提示：ERROR Deployer not found: git</p><p>fix it: </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-admin --save</span><br><span class="line"></span><br><span class="line">npm i hexo-generator-json-content --save</span><br><span class="line"></span><br><span class="line">npm install hexo-abbrlink --save</span><br><span class="line"></span><br><span class="line">npm install hexo-less --save</span><br><span class="line"></span><br><span class="line">npm install hexo-index-anything --save</span><br><span class="line"></span><br><span class="line">npm install hexo-related-popular-posts --save</span><br><span class="line"></span><br><span class="line">npm install hexo-generator-seo-friendly-sitemap --save</span><br><span class="line"></span><br><span class="line">npm install hexo-encrypt --save</span><br></pre></td></tr></table></figure><h3 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h3><p><a href="https://valine.js.org/hexo.html" target="_blank" rel="noopener">valine</a></p><p><a href="https://github.com/litten/hexo-theme-yilia/pull/646" target="_blank" rel="noopener">yilia支持</a></p><p><a href="https://leancloud.cn/dashboard/app.html?appid=8oc8xy8juzYQgFLVSCufkx0F-gzGzoHsz#/key" target="_blank" rel="noopener">leancloud</a></p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>get it and enjoy it!</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Hexo-官方&quot;&gt;&lt;a href=&quot;#Hexo-官方&quot; class=&quot;headerlink&quot; title=&quot;Hexo 官方&quot;&gt;&lt;/a&gt;Hexo 官方&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo主页&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://hexo.io/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo官方文档&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/hexojs/hexo&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="技术" scheme="http://cugbliwei.tech/categories/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="hexo" scheme="http://cugbliwei.tech/categories/%E6%8A%80%E6%9C%AF/hexo/"/>
    
    
      <category term="linux" scheme="http://cugbliwei.tech/tags/linux/"/>
    
      <category term="hexo" scheme="http://cugbliwei.tech/tags/hexo/"/>
    
      <category term="centos" scheme="http://cugbliwei.tech/tags/centos/"/>
    
  </entry>
  
</feed>
